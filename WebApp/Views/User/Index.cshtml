@{
    Layout = "_Layout_Profile";
}
<style>

.reaction-button {
  font-size: 25px; 
  margin-left: 3%;
  color: #b6b6b6
}

.post-photos {
display: flex;
justify-content: center;
align-items: center; 
margin-bottom: 2%; 
margin-top: 2%;
}

.post-text {
margin-left: 3%;
 margin-bottom: 1.5%; 
 margin-top: 1.5%
}

.post-header {
margin: 3% 3% 0%;
display: flex; 
flex-direction: row;
 align-items: flex-start;
}
.comment-header {
display: flex; 
flex-direction: row;
 align-items: flex-start;
}
</style>

@{
    if (Model.Nickname == User.Identity.Name)
    {
        <div style="width: 100%; height: auto; background: #fff; border-radius: 5px; display: flex">
            <div class="container flex-column align-items-center justify-content-center">
                <div class="form-group">
                    <textarea placeholder="Add new post" class="form-control" style="resize: none; overflow: auto; margin-top: 10px;" rows="3" id="comment" name="text"></textarea>
                </div>
                <button class="btn btn-primary mb-3" id="send-post">Submit</button>
            </div>
        </div>
    }
}

<div style="display: flex; flex-direction: column">
    @*
  <div id="post-" class="shadow-lg" style="width: 100%; border-radius: 2px; margin-top: 2%;">
        <div id="post-header-" class="post-header">
            <img src="@Url.Content(@Model.AvatarPath)" width="50px" height="50px" style="border-radius: 50%">
            <div style="padding-left: 15px;">
                <div style="color: #20257c; font-size: 20px;">
                    <a>@Model.Nickname</a>
                </div>
                <div style="color: #b9b9b9">
                    67:89 в дагестане
                </div>
            </div>
            <div id="post-options-" class="dropdown" style="margin-left: auto; color: #b6b6b6">
                <a class="dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></a>
                <div class="dropdown-menu" aria-labelledby="dropdownMenu1">

                </div>
            </div>
        </div>
        <div id="post-text-" class="post-text">
            ЛЯ КАКОЙ))))
        </div>
        <div id="post-photos-" class="post-photos">
            <img src="@Url.Content("~/lya.jpg")" width="400px" height="250px">
        </div>
        <div id="post-reactions-" style="margin-bottom: 2%;">
            <i class="fas fa-heart reaction-button" id="like"></i> 0
            <i class="fas fa-comment reaction-button" id="comment"></i> 0
            <i class="fas fa-reply reaction-button" id="share"></i> 0
        </div>
    </div>*@ 
    <div id="posts"></div>
    
</div>


<script type="text/javascript">

    $(document).ready(function() {
   $.ajax({
           url:'@Url.Action("GetPostsByUserId", "Post")',
           type: 'GET',
           data: {
               id: @Model.Id,
           }
       }).done(function(data) {        
           let ddl = ' ';
                           $.each(data, function(index, element){
                               ddl = PostMakeHTML(element);
                               $(ddl).insertBefore('#posts'); 
                               if(IsPostLikedByUser(element.id)){
                                    $("#l" + element.id).css('color', 'red');
                                    $("#l" + element.id).removeClass("like-post");
                                    $("#l" + element.id).addClass("unlike-post");
                               }
                               $.ajax({
                                          url:'@Url.Action("GetCommentsByPostId", "Post")',
                                          type: 'GET',
                                          data: {
                                              postId: element.id,
                                          }
                                      }).done(function(comments) {
                                         $.each(comments, function(index, comment){
                                             ddl = CommentMakeHTML(comment);
                                             $(ddl).insertAfter('#comments-' + element.id); 
                                         }); 
                                      });
                                  
                           });
                           
     })
 });
 
    $(document).on('click', '.like-post', function() {
             $.ajax({
               url:'@Url.Action("LikeButtonResponse", "Post")',
               type:'POST',
               data: {   
                   postId: $(this).data("id")
               }
             });
             let v = document.getElementById("like-post" + String($(this).data("id")));
             v.innerHTML = String(parseInt(v.innerHTML) + 1);
             $(this).css('color', 'red');
             $(this).removeClass("like-post");
             $(this).addClass("unlike-post");
             
     });
 
    $(document).on('click', '.unlike-post', function() {
             $.ajax({
               url:'@Url.Action("LikeButtonResponse", "Post")',
               type:'POST',
               data: {
                   postId: $(this).data("id")
               }
             });
             let v = document.getElementById("like-post" + String($(this).data("id")));
             v.innerHTML = String(parseInt(v.innerHTML) - 1);
             $(this).css('color', 'gray');
             $(this).removeClass("unlike-post");
             $(this).addClass("like-post");
        });
    
    $(document).on('click', '#send-post', function() {
                $.ajax({
                  url:'@Url.Action("SaveAndReturnPost", "Post")',
                  type:'POST',
                  data: {
                      text: $('#comment').val()
                  }
                })
                .done(function (data){
                    let ddl = ' ';
                    ddl+=PostMakeHTML(data);
                    $(ddl).insertBefore('#posts');            
                    });
           });
    
    $(document).on('click', '#post-comment', function() {
     let postId = 0;
     let button = $(this);
     postId = button.data("id");
                    $.ajax({
                      url:'@Url.Action("SaveAndReturnComment", "Post")',
                      type:'POST',
                      data: {
                          text: $('#comment-' +  button.data("id")).val(),
                          postId: button.data("id")
                      }
                    })
                    .done(function (data){
                        let ddl = ' ';
                        ddl+=CommentMakeHTML(data);
                        $(ddl).insertBefore('#comments-end-' +  postId); 
                        console.log('#comments-of-' +  postId);
                        let v = document.getElementById("comments-of-" + postId);
                        v.innerHTML = " " + String(parseInt(v.innerHTML) + 1);
                    });
               });
        
    $(document).on('click', '#delete-post', function() {
        DeletePost($(this).data("id"));
     });

    let DeletePost = function(id) {
        $.ajax({
        url:'@Url.Action("DeletePost", "Post")',
        type: 'POST',
        data: {
            Id: id
        }
        }).done(function() {
           document.getElementById("post-" + id).innerHTML = "";
        })
    };

   
</script>